<!doctype html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Add Transaction</title>
    <style>
      body { font-family:-apple-system,system-ui,Arial; margin:24px; }
      input, select {
        padding: 10px; width: 100%;
        margin: 6px 0 12px;
        border-radius: 10px; border: 1px solid #ccc;
        box-sizing: border-box;
      }
      button {
        padding: 10px 12px; border-radius: 10px; border: 0;
        background:#111; color:#fff; width:100%;
      }
      .muted { color:#666; font-size: 13px; }
      .row { display:flex; gap:10px; margin-top:12px; }
      .link {
        display:inline-block; padding:10px 12px;
        border:1px solid #333; border-radius:10px;
        text-decoration:none; color:#111; text-align:center; flex:1;
      }
      details { margin: 6px 0 12px; }
      #receiptWrap { display:none; }
    </style>
  </head>
  <body>
    <h2>Add Transaction</h2>
    <p class="muted">Receipts are saved for expenses only (not rental income).</p>

    <div class="row" style="margin-bottom:14px;">
      <a class="link" href="/ui">‚¨ÖÔ∏è Home</a>
      <a class="link" href="/ui/report">üìä Reports</a>
    </div>

    <!-- ONE form only -->
    <form method="post" action="/ui/transaction/new" enctype="multipart/form-data">
      <label>Date</label>
      <input name="tx_date" type="date" required />

      <label>Source</label>
      <select name="source" required>
        <option value="Rental Property" {% if default_source == "Rental Property" %}selected{% endif %}>Rental Property</option>
        <option value="Work Expense" {% if default_source == "Work Expense" %}selected{% endif %}>Work Expense</option>
        <option value="Personal" {% if default_source == "Personal" %}selected{% endif %}>Personal</option>
      </select>

      <label>Type</label>
      <select id="typeSelect" name="type" required>
        <option value="income" {% if default_type == 'income' %}selected{% endif %}>income</option>
        <option value="expense" {% if default_type == 'expense' %}selected{% endif %}>expense</option>
      </select>

      <label>Category</label>
      <select name="category" required>
        <option value="">Select a category‚Ä¶</option>
        {% for c in categories %}
          <option value="{{ c.name }}">{{ c.name }}</option>
        {% endfor %}
      </select>

      <details>
        <summary>‚ûï Add a new category</summary>
        <div class="muted">Add it once and it will appear in the dropdown.</div>
        <form method="post" action="/ui/category/add" style="margin-top:10px;">
          <label>New category name</label>
          <input type="text" name="name" placeholder="e.g., Appliance Repair, Cleaning, Parking‚Ä¶" required />
          <button type="submit">Save Category</button>
        </form>
      </details>

      <label>Amount</label>
      <input name="amount" type="number" step="0.01" required />

      <label>Vendor (optional)</label>
      <input name="vendor" placeholder="Shell, Home Depot, Restaurant..." />

      <label>Notes (optional)</label>
      <input name="notes" placeholder="Anything you want to remember" />

      <div id="receiptWrap">
        <label>Receipt (optional)</label>
        <input name="receipt" type="file" accept="image/*,application/pdf" />
        <p class="muted">On iPhone, choose ‚ÄúTake Photo‚Äù or ‚ÄúPhoto Library‚Äù.</p>
      </div>

      <button type="submit">üíæ Save Transaction</button>
    </form>

    <script>
      function toggleReceipt() {
        const type = document.getElementById("typeSelect").value;
        document.getElementById("receiptWrap").style.display = (type === "expense") ? "block" : "none";
      }
      document.getElementById("typeSelect").addEventListener("change", toggleReceipt);
      toggleReceipt();
    </script>
  </body>
</html>
