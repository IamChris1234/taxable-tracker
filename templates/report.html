<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Reports</title>
  <style>
    body { font-family:-apple-system,system-ui,Arial; margin:24px; }
    .card { border:1px solid #e6e6e6; border-radius:14px; padding:16px; margin-bottom:14px; }
    .row { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .button { display:inline-block; padding:10px 12px; border:1px solid #333; border-radius:10px; text-decoration:none; }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:10px 8px; border-bottom:1px solid #eee; text-align:left; font-size:14px; }
    h2 { margin:0 0 6px; }
    .muted { color:#666; font-size:14px; }
    canvas { max-width: 520px; }
  </style>
</head>
<body>

  <div class="card">
    <h2>üìä Reports ‚Äî {{ year }}</h2>
    <div class="muted">Year totals</div>

    <div class="row">
      <a class="button" href="/ui">üè† Home</a>
      <a class="button" href="/ui/transaction/new">‚ûï Add Transaction</a>
    </div>

    <div style="margin-top:12px;">
      <div><strong>Income:</strong> ${{ '%.2f'|format(income_total) }}</div>
      <div><strong>Expenses:</strong> ${{ '%.2f'|format(expense_total) }}</div>
      <div><strong>Net:</strong> ${{ '%.2f'|format(net_total) }}</div>
    </div>
  </div>

  <div class="card">
    <h3>ü•ß Expenses by category</h3>
    <canvas id="expensePie"></canvas>

    <table style="margin-top:14px;">
      <tr><th>Category</th><th>Total</th></tr>
      {% for cat, amt in by_category %}
      <tr><td>{{ cat }}</td><td>${{ '%.2f'|format(amt) }}</td></tr>
      {% endfor %}
    </table>
  </div>

  <div class="card">
    <h3>üìã All transactions</h3>
    <table>
      <tr>
        <th>Date</th><th>Source</th><th>Type</th><th>Category</th><th>Amount</th><th>Vendor</th><th>Notes</th>
      </tr>
      {% for t in transactions %}
      <tr>
        <td>{{ t.tx_date }}</td>
        <td>{{ t.source }}</td>
        <td>{{ t.type }}</td>
        <td>{{ t.category }}</td>
        <td>${{ '%.2f'|format(t.amount) }}</td>
        <td>{{ t.vendor or '' }}</td>
        <td>{{ t.notes or '' }}</td>
      </tr>
      {% endfor %}
    </table>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const pieLabels = [
      {% for cat, amt in by_category %}"{{ cat }}",{% endfor %}
    ];
    const pieData = [
      {% for cat, amt in by_category %}{{ amt }},{% endfor %}
    ];

    const canvas = document.getElementById("expensePie");
    if (canvas) {
      const ctx = canvas.getContext("2d");
      new Chart(ctx, {
        type: "pie",
        data: {
          labels: pieLabels,
          datasets: [{ data: pieData }]
        },
        options: { responsive: true }
      });
    }
  </script>

</body>
</html>
